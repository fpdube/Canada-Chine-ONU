---
title: "Quels sont les pays aux vues similaires à celles du Canada?"
subtitle: "Votes à l'Assemblée générale des Nations Unies:\nANALYSE PRÉLIMINAIRE"
author: "François-Philippe Dubé"
date: "31/07/2021"
output:
  ioslides_presentation:
    widescreen: true
    smaller: false
    incremental: false
    citation_package: biblatex
    
biblio-style: "apalike"
---

```{r setup, include=FALSE}
# Nota: les fichiers de ce projet sont organisés selon la structure proposée par la bibliothèque ProjectTemplate

library(ProjectTemplate)
load.project() # Charge toutes les bibliothèques de cette analyse, définies dans ./config/global.dcf

# Options de base
knitr::opts_chunk$set(echo = FALSE)
knitr::opts_chunk$set(cache = TRUE, warning = FALSE)
theme_set(theme_minimal()) # Définit le thème utilisé pour les graphiques
```

Questions de recherche
========================

Données de l'AGNU entre 1946 et 2018
-----------------------------------

 - Le chercheur Erik Voeten maintient une base de données de toutes les résolutions votées à l'Assemblée générale des Nations Unies (AGNU) depuis 1946. 

 - La base de données est préservée sur le [*dataverse* de l'Université Harvard](https://dataverse.harvard.edu/dataset.xhtml?persistentId=hdl:1902.1/12379), avec le livre de codes associé.

- Le tableau contient **`r onu %>% pull(resid) %>% unique() %>% length() %>% prettyNum(., scientific = FALSE, big.mark = " ")` résolutions distinctes** depuis 1946, réparties en `r dim(onu)[1] %>% prettyNum(., scientific = FALSE, big.mark = " ")` enregistrements.

 - Le vote de chaque pays y est codé pour chaque résolution : ***Pour, Contre, Abstention, Absence***.


Chaque résolution est associée à un ou plusieurs enjeux particuliers {.columns-2}
--------------------------------------------------------------------

Les six enjeux sont :

- Colonialisme
- Développement économique
- Désarmement et contrôle des armes
- Droits de la personne
- Moyen-Orient
- Nucléaire

Certains enjeux importants récents sont absents :

- Changements climatiques
- Migrations
- Guerres civiles...

Deux questions de recherche {.build}
------------------------------------

### Q1 : Comment le Canada a-t-il voté sur ces six enjeux depuis 1990?

**Analyse descriptive **: évolution de la proportion de votes « pour » par enjeu
  
### Q2 : Comment les pays se regroupent-ils en fonction de leurs habitudes de vote?

**Analyse par apprentissage automatique** pour mettre à jour les habitudes de vote, d'abstention et d'absence des membres de l'ONU
 


Tendances de vote du Canada à l'ONU
====================================

```{r prep_graphique_par_enjeux, echo=FALSE, message=FALSE}
# Définition d'un jeu de données plus restreint
td_can <- onu %>%
  # On ne garde que le Canada
  filter(pays == "CAN" & year > 1989) |>
  distinct(year, pays, .keep_all = TRUE) |> 
  ungroup()

td_ocde <- onu %>%
  # On ne garde que les pays de l'OCDE
  filter(pays %in% memberstates$oecd$iso3c & year > 1989) |>
  select(pays, year, starts_with("prop_")) |> 
  distinct(year, pays, .keep_all = TRUE) |> 
  group_by(year) 

td_ocde <- td_ocde[complete.cases(td_ocde),] 

######  À FAIRE: utiliser les quantile 10%-90% pour un geom_ribbon
# td_ocde |>
#   summarize(D10 = across(prop_oui:prop_nucleaire, ~ quantile(.x, probs = c(0.1))),
#             D90 = across(prop_oui:prop_nucleaire, ~ quantile(.x, probs = c(0.9)))) |> View()
###########################

vec_pm <- PM |> filter(debut > 1989) |> mutate (parti = factor(parti)) |> select(debut, parti) 
group.colors = c(libéral = "red", conservateur = "blue")

fonction_enjeux <- function(df, .enjeu) {
  .enjeu_long <- enjeux %>%
    filter(court == (.enjeu)) %>%
    pull(long)
  
  
  df %>%
    ggplot(aes(year, !! sym(str_c("prop_", .enjeu)))) +
    geom_smooth(colour = "gray") +
    geom_line(size = 0.8, alpha = 0.8, colour = "black") +
    geom_vline(data = vec_pm, 
               aes(xintercept = debut, colour = parti), lty = 2) +
    
    xlab("") +
    ylab("Prop. annuelle de votes « POUR » par enjeu") +
    ggtitle(label = sym(.enjeu_long)) +
      scale_y_continuous(
      labels = scales::percent,
      limits = c(0, 1),
      breaks = c(0.25, 0.50, 0.75)
    ) +
    scale_x_continuous(breaks = vec_pm$debut) +
    scale_color_manual(values=group.colors) +
    theme_gray() +
    theme(legend.position = "none") +
    theme(strip.text = element_text(hjust = 0.5)) +
    theme(axis.text.x = element_text(angle = 90, hjust = 1)) +
    theme(strip.placement = "outside")
}

graphes_can <- map(~ fonction_enjeux(df = td_can, .enjeu = .x), .x = enjeux$court[2:7])
```

Le Canada appuie fortement le développement économique depuis la fin de la Guerre froide...
-----------------------------------------------------

```{r graphique_par_enjeux1, echo=FALSE, message=FALSE, cache = FALSE, fig.width=10.5}
# Premier graphique
patchwork::wrap_plots(graphes_can[c(3, 2, 6)], ncol = 3) 
```

... mais sa position sur le Moyen-Orient s'est raffermie depuis 2000 (et part. 2006)
------------------------------------

L'élection de 2015 n'a pas changé cette position sur les enjeux ci-dessous.
```{r graphique_par_enjeux2, echo=FALSE, message=FALSE, cache = FALSE, fig.width=10.5}

# Deuxième graphique
patchwork::wrap_plots(graphes_can[c(1, 4, 5)], ncol = 3)
```




Regroupement des pays à l'ONU d'après leurs habitudes de vote | 2015 à 2018 : quatre années de données depuis\nl'élection du gouvernement libéral
=============================================================


```{r, definition_tableau_pour_regroupement, include=FALSE, echo=FALSE, message=FALSE}
td_long <- onu %>%
  # On filtre les données à partir de la 70e session, en 2015 (PLC)
  # Alternativement, on pourrait prendre les données à partir la 61, en 2006 (PCC)
  filter(session >= 70) %>%
  # Évite les dédoublements, au cas où il y en aurait
  distinct(resid, pays, vote_long) %>%
  # Développe toutes les combinaison pays x resid possibles; introduit des NA
  # dans vote_long où cette combinaison n'existait pas
  complete(pays, nesting(resid)) %>%
  mutate(
    vote_long = replace_na(as.character(vote_long), "na"), # Transforme ces NA en chaînes "na"
    id_vote = str_c("res", resid, vote_long, sep = "_"), # crée un identifiant de vote comme "res_1001_pour"
    valeur = 1 # Cette valeur deviendra notre valeur instrumentale lorsque le tableau sera pivoté
  ) %>%
  # On élimine les situations potentielles de vote unanime, peu utiles pour l'algorithme de groupement
  group_by(resid) %>%
  mutate(variations = n_distinct(vote_long)) %>%
  ungroup() %>%
  filter(variations > 1)

# On crée un tableau large comprenant comme colonnes toutes les combinaisons possibles
# de résolutions x vote (Pour, Contre, Abstention)
td_large_gmm <- td_long %>%
  pivot_wider(
    id_cols = pays,
    names_from = id_vote,
    values_from = valeur,
    values_fill = 0
  ) %>%
  column_to_rownames("pays") %>%
  select(order(colnames(.))) %>%
  # Pour utiliser un algorithme de classement, on doit mettre les valeurs à l'échelle
  mutate(across(where(is.numeric), ~ as.numeric(scale(.))))
```

```{r, regroupements_finaux, include=FALSE, echo=FALSE, message=FALSE}

set.seed(42)
modele_BIC <- mclustBIC(td_large_gmm, G = 1:15) 
gmm_modele <- Mclust(td_large_gmm, G = 9)

gmm_res <- gmm_modele %>% 
  augment(., td_large_gmm) %>% 
  rename(
    pays = .rownames,
    cluster = .class
  ) %>%
  select(pays, cluster)

# On recrée un tableau avec les proportions de vote par pays x année, avec les regroupements

onu_final <- onu %>%
  filter(session >= 70 & pays != "YUG") %>%
  group_by(pays) %>%
  select(c(pays, starts_with("prop"))) %>%
  rename(prop_total = prop_oui) %>%
  summarize(across(starts_with("prop"), mean)) %>%
  ungroup() %>%
  inner_join(gmm_res, by = "pays") %>%
  mutate(pays_long = countrycode(pays, origin = "iso3c", destination = "un.name.fr")) %>%
  select(pays_long, pays, cluster, prop_total, everything()) %>% 
  rename(Groupe = cluster) |> 
  ungroup() |> 
  group_by(Groupe) |> 
  mutate(prop_groupe = mean(prop_total)) |> 
  arrange(prop_groupe, .by_group = FALSE)

td_rang <- onu_final |> select(Groupe, prop_groupe) |> summarize(prop_groupe = mean(prop_groupe)) |> arrange(-prop_groupe) |> mutate(rang = as_factor(1:9)) |> select(-prop_groupe)

onu_final <- onu_final |> left_join(td_rang) |> mutate(Groupe = rang) |> select(-rang)

```


(Parenthèse 1 : Qu'est-ce que la classification par apprentissage automatique?) {.smaller .columns-2} 
----------------------------------------------------------

```{r, exemple_kmeans, echo=FALSE, message=FALSE, fig.width=5.5}
x <-  iris[,-5]
y <-  iris$Species 
kc <- kmeans(x, 3)
plot(x[c("Sepal.Length", "Sepal.Width")], col=kc$cluster)
points(kc$centers[,c("Sepal.Length", "Sepal.Width")], col=1:3, pch=23, cex=3)
```

 - Méthode d'**apprentissage automatique** visant à découvrir la structure « cachée » des données à travers ses multiples dimensions (variables).
 - But : définir des groupes **maximisant** la distance *entre* les grappes tout en **minimisant** la distance *au sein* d'une même grappe
 - On essaie d'optimiser le nombre de groupes pour extraire autant d'information que possible des données dans le plus petit nombre de groupes


(Parenthèse 2 : Deux questions méthodologiques se sont posées) {.smaller .columns-2}
-----------------------------------------------------------------

```{r, info_BIC, echo=FALSE, message=FALSE, fig.width=5.5}
mclustBIC(td_large_gmm, G = c(2:15)) |> plot()
abline(v = 9, col = "red", lty = 2)

```

**Quel algorithme utiliser?** 

 - Le plus standard, `K-Means`, ne donne pas des résultats stables lorsque les groupes sont de taille très différentes. 
 - Nous avons utilisé `Mclust`, qui produit des résultats constants pour ce jeu de données.

**Combien de grappes définir?** 

 - En théorie: neuf serait optimal pour ce jeu de données. 
 - En pratique, c'est beaucoup pour l'analyse.


Donner un sens à un monde divisé en neuf
--------------------------------------------------------------------------


```{r, choroplèthe, fig.width=10.5, echo=FALSE, message=FALSE}
## Carte des regroupements
monde %>%
  left_join(select(onu_final, pays, Groupe), by = c("ISO_A3_EH" = "pays")) %>% 
  select(c(scalerank, LABELRANK, SOVEREIGNT, ISO_A3_EH, Groupe, everything())) %>% 
  filter(!is.na(ISO_A3_EH), 
         !is.na(Groupe)) |> 
  st_transform(crs = "+proj=eqearth +wktext") %>%
  ggplot() +
  geom_sf(aes(fill = Groupe)) +
  theme_void() +
  labs(title = "Regroupements des pays selon leur vote à l'Assemblée générale des Nations Unies",
       subtitle = "Sessions 70 à 73 (2015 à 2018)",
       fill = "Groupe") +
  scale_fill_brewer(palette = "Set1") +
  theme_void() +
  theme(legend.position = "right")
```

Les pays en développement se divisent en trois groupes principaux {.columns-2}
-------------------------------------------------------

**Groupe 1: le plus progressiste** : 84 pays incluant plusieurs de nos partenaires économiques ou de développement.

 - Majorité de l'Afrique, 
 - Mongolie, Indonésie  
 - Pays du Golfe
 
**Groupe 3: le plus militant** : 16 pays

 -  Chine, Cuba, Corée du Nord, Russie, Iran, Inde, etc.
 
**Groupe 4: un groupe moins radical** : 26 pays, dont plusieurs SIDS, aux positions plus conservatrices sur le colonialisme et le Moyen-Orient. 

 - Haïti et la majorité des Îles du Pacifique 
 - Cameroun, Ghana, RDC et quelques pays d'Afrique centrale.
 

Les groupes de pays développés se divisent aussi en trois groupes inégaux
---------------------------------------------------

**Groupe 5: La quasi-totalité du CAD de l'OCDE** : 

 - 47 pays incluant toute l'Europe, la Turquie, Australie et NZ, Corée du Sud et Japon.

**Groupe 7: Le Canada et trois SIDS** : 

 - Micronésie, Îles Marshall, Palaos.

**Groupe 9: Les É-U et Israël**.


On trouve trois autres petits groupes
------------------------------------

**Groupe 8: PD proches de la position canadienne** : 

 - cinq SIDS (Dominique, Grenade, Nauru, Sao Tomé-et-Principe, Seychelles)
 - Soudan du Sud, Niger

**Groupe 6: pays conservateurs quant au développement économique**  

 - Gabon, Gambie, Guinée équatoriale, Rwanda, Somalie.

**Groupe 2: Zimbabwe** 


Le Canada est proche de la position des autres pays du CAD (Gr. 5) sur trois enjeux | Il est également proche du Gr. 8
------------------------------------------------------------

```{r, prep_boxplot, echo=FALSE, message=FALSE}
moy_CAN <- onu_final |>
  filter(pays == "CAN") |>
  summarize(across(starts_with("prop_"), mean))

fn_graphique_boxplot <- function(df, .enjeu) {
  # .enjeu_long pour reproduire le nom de l'enjeu au propre ds le titre
  .enjeu_long <- enjeux %>%
    filter(court == (.enjeu)) %>%
    pull(long)
  
  # Fonction ggplot pour boxplot
  graphe <- df %>%
    ggplot(aes(
      x = Groupe,
      y = !!sym(str_c("prop_", .enjeu)),
      colour = Groupe
    )) +
    
    geom_boxplot() +
    #geom_jitter(heigth = 0.2, alpha = 0.3, size = 3, color = "black") +
    #   theme(legend.position = "right") +
    
    # geom_dotplot(
    #   data = (onu_final %>% filter(pays == "CAN")),
    #   binaxis = 'y',
    #   dotsize = 0.8,
    #   stackdir = "center",
    #   fill = "red",
    #   binwidth = 0.05
    # ) +
  
  ggforce::geom_mark_rect(aes(
    fill = "indianred1",
    filter = pays_long == "Canada",
    label = pays_long,
    expand = unit(-3, "mm")
  )) +
    
    geom_hline(
      data = moy_CAN,
      aes(yintercept = !!sym(str_c("prop_", .enjeu))),
      colour = "red",
      linetype = 2
    ) +
    ylab("Proportion de votes « POUR » par enjeu") +
    ggtitle(label = sym(.enjeu_long)) +
    scale_y_continuous(
      labels = scales::percent,
      limits = c(0, 1),
      breaks = c(0, 0.25, 0.50, 0.75)
    ) +
    
    scale_color_brewer(palette = "Set1") +
    # scale_fill_brewer(palette = "Set1") +
    
    theme_gray() +
    theme(legend.position = "none") +
    theme(strip.text = element_text(hjust = 0.5)) +
    theme(strip.placement = "outside")
}
graphes_boxplot <-
  map( ~ fn_graphique_boxplot(df = onu_final, .enjeu = .x), .x = enjeux$court)
```


```{r, boxplot_canada_ds_moyenne, echo=FALSE, message=FALSE, fig.width=10.5}
patchwork::wrap_plots(graphes_boxplot[c(4, 3, 7)], ncol = 3) + plot_layout(guides = "collect")
```

La position canadienne sur le Moyen-Orient et les droits de la personne est alignée sur le Gr. 9 | Le Gr. 8 partage la position canadienne sur le colonialisme
----------------------------------------
```{r, boxplot_canada_près_du_groupe3, echo=FALSE, message=FALSE, fig.width=10.5}
patchwork::wrap_plots(graphes_boxplot[c(2, 5, 6)], ncol = 3) + plot_layout(guides = "collect") 
```

Conclusions
============

Le Canada a des habitudes de vote plus « conservatrices » à l'AGNU
-------------------------------------------------------------

**Les années Harper ont durablement influencé la position canadienne à l'AGNU.** Le Canada a des habitudes de vote qui le distinguent de celles de la grande majorité des pays en développement et de presque tous les pays développés.

**En fonction des enjeux, certains pays en développement aux vues plus conservatrices seraient de bons « pays aux vues similaires ».** C'est le cas des pays du groupe 8.

**Cependant, la majorité de nos partenaires de développement sont très progressistes.** Il s'agit surtout de pays d'Afrique continentale, d'Amérique latine et d'Asie du Sud-Est qui forment le Groupe 1.


Références
===========================

Données et logiciels utilisés
-------------------------------

R Core Team (2021). R: A language and environment for statistical computing. R Foundation for Statistical Computing, Vienna, Austria. https://www.R-project.org/.

Scrucca L., Fop M., Murphy T. B. and Raftery A. E. (2016) mclust 5: clustering, classification and density estimation using Gaussian finite mixture models The R Journal 8/1, pp. 289-317

Voeten, E. "Data and Analyses of Voting in the UN General Assembly," *Routledge Handbook of International Organization*, edited by Bob Reinalda (publié le 27 mai 2013), disponible à SSRN: http://ssrn.com/abstract=2111149.

Wickham, H. ggplot2: Elegant Graphics for Data Analysis. Springer-Verlag New York, 2016.

