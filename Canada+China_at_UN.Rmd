---
title: "Canada and China's performance at the UN"
author: "François-Philippe Dubé"
date: "14/02/2021"
output: html_document
---

```{r setup, include=FALSE, echo=FALSE}
# Charger les bibilothèques du projet
# devtools::install_github("dgrtwo/unvotes") # Ne faire qu'une seule fois
library(ProjectTemplate)
load.project()

# Define options
knitr::opts_chunk$set(echo = FALSE)
knitr::opts_chunk$set(fig.width=8, fig.height=6) 
theme_set(theme_minimal()) # Définit le thème utilisé pour les graphiques

# Télécharger une base de données d'indicateurs de la Banque mondiale
# new_cache <- wb_cache() # Ne faire qu'une seule fois
# cache("new_cache") # Ne faire qu'une seule fois
```

Description et exploration visuelle des données
=================================================

Le paquet `un_votes` donne l'historique des votes à l'ONU des États-membres, en en donnant des précisions telles que les dates du vote, le descriptif du sujet, et l'enjeu qu'il couvre. Nous avons installé [la version de développement du paquet](https://github.com/dgrtwo/unvotes), plus complète que son équivalent CRAN, et qui s'étend de 1946 à 2019.

Ces données proviennent du jeu de données original suivant:

> Erik Voeten "Data and Analyses of Voting in the UN General Assembly," *Routledge Handbook of International Organization*, edited by Bob Reinalda (publié le 27 mai 2013), disponible à SSRN: http://ssrn.com/abstract=2111149.

À noter que le jeu de données original est maintenu sur le [*dataverse* de l'Université Harvard](https://dataverse.harvard.edu/dataset.xhtml?persistentId=hdl:1902.1/12379), avec son livre de codes expliquant les variables utilisées.

Le paquet `unvotes` comprend trois jeux de données: 

* `un_roll_calls` décrit les session de votes à l'ONU. *Nota: La variable `importantvote` de  `un_roll_call` correspond aux votes importants pour les É-U à partir de `r min(un_roll_calls$date)`, et codé jusqu'à `r max(un_roll_calls$date)`.* Elle sera donc utile pour voir dans quelle mesure le Canada et la Chine s'éloignent des États-Unis sur des votes considérés importants pour le maintien de l'ordre mondial.

* `un_roll_call_issues` identifie un enjeu pour chacun des éléments faisant l'objet d'un vote. Noter que la variable `issue` catégorise les votes selon les enjeux suivants: `r unique(un_roll_call_issues$issue)`.

* `unvotes` décrit comment chaque État-membre a voté (en faveur, contre, abstention) à chacun des votes.

Chacun des ces jeux peut être joint aux autres par la colonne `rcid` (**roll call ID**). Nous allons travailler sur un tableau consolidé. Le tableau final fait En voici un extrait.

```{r consolidation, echo = TRUE}
votes <- un_votes %>% right_join(., un_roll_calls, by = "rcid")
votes <- votes %>% right_join(., un_roll_call_issues, by = "rcid")
votes <- votes %>% select(-c(amend, para))
votes <- votes[complete.cases(votes), ] # Petite perte de 6% des données.
sample_n(votes, 3) %>% kable()
```

Alternative: Utilisation du jeu de données récent et complet de Erik Voeten
============================================================================
Le chercheur Erik Voeten maintien une version plus à jour des données sur le dataverse de l'Université Harvard. À l'heure actuelle, celles-ci vont jusqu'à 2019. Le codage de la base de données est un peu différent, cependant, puisque les variables factorielles (notamment la catégorisation des résolutions en six enjeux) sont codées sous forme de variables instrumentales. Deux différences importantes par rapport à la base de données du CRAN: plusieurs résolutions ne sont associées à aucun enjeux, et plusieurs enjeux peuvent être associés à une même résolution.  

```{r manip_complete_votes}
# Télécharger la base de données -- ne faire qu'une seule fois
# download.file("https://dataverse.harvard.edu/api/access/datafile/:persistentId?persistentId=doi:10.7910/DVN/LEJUQZ/MLNAHB", "./data/onu_votes.RData")
# load("./data/onu_votes.RData")

# Recoder certaines valeurs et renommer les variables d'enjeux et de pays
onu <- completeVotes %>% 
  mutate(vote_long = factor(vote, labels = c("Pour", "Abstention", "Contre", "Absent", "Non membre"))) %>% 
  rename(moyen_orient = me, 
         nucleaire = nu, 
         desarmement = di, 
         droit_pers = hr, 
         colonialisme = co, 
         dev_econ = ec, 
         pays = Country, 
         pays_long = Countryname) %>% 
  # Reformater le tableau
  select(resid, member, vote, vote_long, year, importantvote, short, descr, moyen_orient, nucleaire, 
         desarmement, droit_pers, colonialisme, dev_econ, everything())


```









Définitions - Quelques groupes de pays
======================================

Pour l'analyse, nous allons définir certains groupements de pays: G7, G20, pays en développement (séparés en pays à revenus faibles ou moyens), Afrique sub-saharienne. Nous n'allons garder que les codes ISO à deux lettres pour simplifier les manipulations. Nous allons utiliser la base 

```{r definitions_pays}

g7 <- c("Canada", "France", "Germany", "Italy", "Japan", "United Kingdom", 
        "United States") %>%
  countrycode(., origin = "country.name", destination = "iso2c")

g20 <- c("Argentina", "Australia", "Brazil", "Canada", 'China', "France", "Germany", "India", "Indonesia", "Italy", "Japan", "Mexico", "Netherlands", "Russia", "Saudi Arabia", "Singapore", "South Africa", "South Korea", "Spain", "Switzerland", "Turkey", "United Kingdom", "United States") %>% countrycode(., origin = "country.name", destination = "iso2c")

# Pour l'Afrique sub-saharienne, on utilise la base de données du paquet countrycode
afr <- countrycode::codelist_panel %>% 
  filter(year == 2020 & region == "Sub-Saharan Africa" & !is.na(iso2c)) %>% 
  pull(iso2c) # dplyr::pull permet de retourner un vecteur


# Pour les pays en développement, on génère un tableau de la 
# Banque mondiale et on en extrait les pays en développement

# Tableau de données de tous les pays (il y en a 218)
pays <- wb_countries() %>% 
  filter(income_level != "Aggregates") %>% 
  select(-c(capital_city, contains("_iso2c"), iso3c, contains("admin_")))

# Les pays en développement
dev <- pays %>% filter(income_level_iso3c != "HIC") %>% pull("iso2c")
lic <- pays %>% filter(income_level_iso3c == "LIC") %>% pull("iso2c")
lmic <- pays %>% filter(income_level_iso3c == "LMC") %>% pull("iso2c")
umic <- pays %>% filter(income_level_iso3c == "UIC") %>% pull("iso2c")
```



Analyse - Partie 1: Évolution de la position du Canada à l'ONU 
==============================================================

```{r position_can_us_zh}
# votes %>% 
#   filter(country_code %in% c(g7, "zh") %>% 
#            group_by(year = year(year), country_code) %>% 
#            summarize(prop_oui = mean(vote == "yes"))

votes %>% 
  group_by(year = year(date), country) %>%
  filter(country_code %in% c("CA", "US", "ZH") & year > 1989) %>% 
  summarize(percent_yes = mean(vote == "yes")) %>%
  ggplot(mapping = aes(x = year, y = percent_yes, color = country)) +
    geom_line() +
    ylab("% of votes that are 'Yes'")

```


