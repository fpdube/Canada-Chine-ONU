---
title: "Dans quelle mesure le Canada et les pays avancés ont-ils délaissé le champ normatif à l'ONU au profit de la Chine?"
author: "François-Philippe Dubé"
date: "06/04/2021"
output: html_document
---

```{r setup, include=FALSE, echo=FALSE}

# Nota: les fichiers de ce projet sont organisés selon la structure proposée par la bibliothèque ProjectTemplate
library(ProjectTemplate)
load.project() # Charge toutes les bibliothèques de cette analyse, définies dans ./config/global.dcf

# Define options
knitr::opts_chunk$set(echo = FALSE)
knitr::opts_chunk$set(fig.width = 8, fig.height = 8)
knitr::opts_chunk$set(cache = TRUE, warning = FALSE)
theme_set(theme_minimal()) # Définit le thème utilisé pour les graphiques

# Télécharger une base de données d'indicateurs de la Banque mondiale
# new_cache <- wb_cache() # Ne faire qu'une seule fois
# cache("new_cache") # Ne faire qu'une seule fois
```

Le Canada face aux pays en développement à l'ONU
=============================================

La défaite récente du Canada à l'élection au Conseil de sécurité de l'ONU (au profit des candidatures de la Norvège et de l'Irlande), pose la question du positionnement du Canada face aux pays en développement à l'ONU. De façon plus large, on peut se demander si le pays avancés--particulièrement ceux du G7--ont bien réussi à répondre aux aspirations exprimées à l'Assemblée générale des Nations unies (AGNU) par les pays en développement, et si la Chine n'est pas plus en phase avec leurs préférences à l'ONU.

Plan de l'analyse
-----------------
Le présent rapport vise à explorer ces questions à travers les tendances de vote des membres de l'AGNU désagrégées selon six enjeux-types par Erik Voeten de l'université Harvard. Il est structuré comme suit. 

1. Description des données  
2. Positionnement des pays du G7 et de la Chine par enjeux  
3. Positionnement du Canada, de l'Irlande et de la Norvège par enjeux 
4. Classification des pays en développement à l'ONU selon leurs tendances de vote  
5. Annexe  

1. Description des données
=================================================

Le chercheur Erik Voeten maintien une base de données de toutes les résolutions votées à l'Assemblée générale des Nations Unies (AGNU) depuis 1946. 

Cette base de données est présevée sur le [*dataverse* de l'Université Harvard](https://dataverse.harvard.edu/dataset.xhtml?persistentId=hdl:1902.1/12379), avec le livre de codes associé expliquant les variables utilisées.

> Erik Voeten "Data and Analyses of Voting in the UN General Assembly," *Routledge Handbook of International Organization*, edited by Bob Reinalda (publié le 27 mai 2013), disponible à SSRN: http://ssrn.com/abstract=2111149.


Chaque résolution est associée à un ou plusieurs enjeux particuliers:  
- Colonialisme  
- Développement économique  
- Désarmement  
- Droits de la personne  
- Moyen-Orient  
- Nucléaire  

Nous y avons rajouté une septième catégorie, "Autre", pour identifier les résolutions n'entrant dans aucune des catégories ci-dessus.  

On note que certains enjeux importants, comme les changements climatiques, les migrations, les guerres civiles, etc., qui n'ont eu une importance que récemment, sont absents de cette classification.

***À Noter***: Le paquet **R** `un_votes` sur le dépôt du CRAN contient sensiblement les mêmes données. En dépit du fait qu'elle requiert plus de manipulations, nous lui avons préféré la base de données du dépôt de Harvard, et ce pour deux raisons. D'abord, elle est plus à jour et couvre jusqu'en `r max(completeVotes$year)` (alors que celle du paquet ne couvre que jusqu'à 2015). Ensuite, le codage des enjeux a été fait différemment, permettant la possibilité qu'une résolution couvre plus qu'un enjeu ou qu'elle n'en couvre aucun -- ce qui est plus réaliste -- plutôt que de forcer toutes les résolutions à entrer dans une seule catégorie.

Nous présentons un échantillon du tableau en annexe. 

```{r nettoyage}
# Télécharger la base de données -- ne faire qu'une seule fois
# download.file("https://dataverse.harvard.edu/api/access/datafile/:persistentId?persistentId=doi:10.7910/DVN/LEJUQZ/MLNAHB", "./data/onu_votes.RData")
# load("./data/onu_votes.RData")


# On recode certaines valeurs et renomme les variables d'enjeux et de pays
onu_large <- completeVotes %>%
  mutate(vote_long = factor(vote, labels = c("Pour", "Abstention", "Contre", "Absent", "Non membre"))) %>%
  rename(
    moyen_orient = me,
    nucleaire = nu,
    desarmement = di,
    droit_pers = hr,
    colonialisme = co,
    dev_econ = ec,
    pays = Country,
    pays_long = Countryname
  ) %>%
  
  # On ajoute un enjeu "autre"
  mutate(
    nb_enjeux = (moyen_orient + nucleaire +
      desarmement +
      droit_pers +
      colonialisme +
      dev_econ),
    autre = if_else(nb_enjeux == 0, 1, 0)
  ) %>%
  
  # On enlève les "votes" des non-membres et les résolutions identiques (3%)
  filter(vote != 9 & ident == 0) %>%
  
  # On mesure la proportion de votes "en faveur" des résolutions de l'AGNU tous
  # enjeux confondus par pays et par année.
  group_by(year = year(date), pays) %>%
  mutate(prop_oui = mean(vote_long == "Pour")) %>%
  ungroup() %>%
  
  # On reformate le tableau le tableau en y enlevant les variables redondantes
  select(
    resid, vote_long, year, pays, prop_oui, importantvote, short, moyen_orient, nucleaire,
    desarmement, droit_pers, colonialisme, dev_econ, autre, nb_enjeux,
    everything(),
    -rcid, -amend, -member, -ccode, -ident
  )


## Définition des enjeux: on va les passer en boucle
enjeux <- tibble(
  court = c(
    "autre",
    "colonialisme",
    "desarmement",
    "dev_econ",
    "droit_pers",
    "moyen_orient",
    "nucleaire"
  ),
  long = c(
    "Autre",
    "Colonialisme",
    "Désarmement",
    "Développement économique",
    "Droits de la personne",
    "Moyen-Orient",
    "Nucléaire"
  )
)

## On définit un tableau "long" intégrant les enjeux dans les variables
onu <- onu_large %>%
  pivot_longer(cols = all_of(enjeux[[1]]), names_to = "enjeux", values_to = "valeur") %>%
  filter(valeur == 1) %>%
  select(resid, year, pays, vote_long, enjeux, everything(), -valeur)
```

Le tableau contient `r onu_large %>% pull(resid) %>% unique() %>% length()` résolutions distinctes depuis 1946, codées sur `r dim(onu_large)[2]` variables par `r dim(onu_large)[1]` rangées. 

Un échantillon en est présenté en annexe.

Définitions - Quelques groupes de pays
--------------------------------------

Pour l'analyse, nous allons définir certains groupements de pays: G7, G20, pays en développement (séparés en pays à revenus faibles ou moyens), Afrique subsaharienne.

```{r definitions_pays}
# Dans cette section, on crée des "vecteurs" contenant différents regroupements de pays

g7 <- c(
  "Canada", "France", "Germany", "Italy", "Japan", "United Kingdom",
  "United States"
) %>%
  countrycode(., origin = "country.name", destination = "iso3c")

g20 <- c("Argentina", "Australia", "Brazil", "Canada", "China", "France", "Germany", "India", "Indonesia", "Italy", "Japan", "Mexico", "Netherlands", "Russia", "Saudi Arabia", "Singapore", "South Africa", "South Korea", "Spain", "Switzerland", "Turkey", "United Kingdom", "United States") %>% countrycode(., origin = "country.name", destination = "iso3c")

# Pour l'Afrique sub-saharienne, on utilise la base de données du paquet countrycode
afr <- countrycode::codelist_panel %>%
  filter(year == 2020 & region == "Sub-Saharan Africa" & !is.na(iso3c)) %>%
  pull(iso3c) # dplyr::pull permet de retourner un vecteur

# Pour les pays en développement, on génère un tableau de la
# Banque mondiale et on en extrait les pays en développement (il y en a 218)
if (!exists("pays")) {
  pays <- wb_countries() %>%
    filter(income_level != "Aggregates") %>%
    select(-c(capital_city, contains("_iso2c"), contains("admin_")))
  cache("pays")
}

# Les pays en développement -- on en fait des vecteurs
dev <- pays %>%
  filter(income_level_iso3c != "HIC") %>%
  pull("iso3c")
lic <- pays %>%
  filter(income_level_iso3c == "LIC") %>%
  pull("iso3c")
lmic <- pays %>%
  filter(income_level_iso3c == "LMC") %>%
  pull("iso3c")
umic <- pays %>%
  filter(income_level_iso3c == "UMC") %>%
  pull("iso3c")
```


Analyse - Partie 1: Évolution de la position du Canada à l'ONU 
==============================================================

Par rapport au G7: Le Canada est devenu le second pays le plus conservateur
---------------------------------------------------------------

**De façon générale, La Chine vote beaucoup plus souvent en faveur des propositions de l'AGNU que les pays du G7.** À l'inverse, comme on peut le voir ci-dessous, les États-Unis sont le pays le plus conservateur à l'AGNU parmi les pays du G7, *tous enjeux confondus*. Le fait que le Japon soit le pays le plus libéral du G7 semble cohérent avec sa doctrine de promotion du "soft power" dans ses relations internationales. 

La position du Canada à l'AGNU a progressivement décliné depuis 2005, année marquant le début du premier mandat du gouvernement conservateur de Stephen Haper. L'arrivée au pouvoir du gouvernement libéral de Justin Trudeau en 2015 est accompagnée d'une remontée dans la proportion de votes en faveur des résolutions à l'AGNU. Cependant, le Canada demeurait, en 2017 et 2018, moins enclin à appuyer ces résolutions que les autres pays du G7.


```{r position_can_us_zh, fig.height=6, fig.width=8, message=FALSE, warning=FALSE}
# # Note méthodologique: pour mesurer la proportion de votes "en faveur" des
# motions de l'AGNU tous enjeux confondus, on doit utiliser onu_large, puisque
# "onu" (au format long) a un nombre variable d'enjeux (et donc de lignes) pour
# chaque résolution qui fausse le calcul des proportions. Nous avons déjà
# calculé cette proportion plus haut.

# On définit un sous-tableau qui fait la moyenne des pays du G7 outre CAN et USA
  td_G5 <- 
  onu_large %>%
  group_by(year = year(date)) %>%
  filter(year > 1999 & pays %in% c("DEU", "FRA", "GBR", "ITA", "JPN")) %>% 
    summarize(max_oui = max(prop_oui),
              min_oui = min(prop_oui),
              prop_oui = mean(prop_oui),
              pays = "Reste du G7"
    )

# Graphique G7 et Chine
onu_large %>% 
  group_by(year = year(date), pays) %>%
  filter(year > 1999 & pays %in% c("CAN", "CHN", "USA")) %>%
  select(pays, year, prop_oui) %>% 
  
  # On y joint ici le tableau fait plus haut
  bind_rows(td_G5) %>% 
  
  ggplot(aes(x = year, y = prop_oui, color = pays)) +
  geom_line(size = 1.5, alpha = 0.5) +
  geom_ribbon(aes(x = year, ymin = min_oui, ymax = max_oui, fill = pays),
                colour = NA,
                alpha = 0.2,
                show.legend = FALSE) +
  ylab('Proportion des votes "en faveur"') +
  xlab("Année") +
  ggtitle(
    "La Chine vote plus souvent en faveur des résolutions de l'AGNU",
    "Le Canada est maintemant le second pays le plus consverateur du G7 à l'ONU"
  ) +
  theme(legend.position = "none") +
  scale_y_continuous(labels = scales::percent) +
  theme_minimal()
  
  
```

... mais les enjeux du Moyen-Orient et de droits de la personne tirent le Canada vers le bas
------------------------------------------------------

**La Chine, le Japon et les États-Unis ont une position très stable l'un par rapport à l'autre sur chaque enjeu.** La Chine vote plus souvent en faveur des résolutions de l'ONU que tous les pays du G7 confondus, indépendamment des enjeux. À l'inverse, les États-Unis demeurent le pays le plus conservateur du G7 pour tous les enjeux et presque toutes les années depuis 2000.   

**La position du Canada parmi les membres du G7 change considérablement selon les enjeux.** Ainsi, dans les dernières années le Canada a voté de façon plus progressive sur les enjeux du désarmement et du développement économique. Il s'est situé dans la tendance médiane des pays du G7 sur les questions nucléaire et possiblement du colonialisme. 

**Sur les questions relatives aux droits de la personne et au Moyen-Orient, le Canada a arrimé sa position sur celle des États-Unis depuis 2010.** Fait intéressant, l'arrivée d'un gouvernement libéral n'a rien changé sur ce plan. Dans tous les cas, la position du Canada sur ces deux enjeux explique son conservatisme global à l'AGNU.


```{r graphique_par_enjeux1, fig.width=6, fig.height=16}
# Définition d'un jeu de données plus restreint
onu_enjeux <- onu_large %>%
  group_by(year = year(date), pays) %>%
  filter(year > 1999 & pays %in% c(g7, "CHN")) %>%
  mutate(prop_oui = mean(vote_long == "Pour"))


# Définition d'une fonction graphique générique -- source:
# https://stackoverflow.com/questions/4856849/looping-over-variables-in-ggplot,
# answered Aug 27 '18 at 19:10 by Tung


fonction_enjeux <- function(df, .enjeu) {
  .enjeu_long <- enjeux %>%
    filter(court == (.enjeu)) %>%
    pull(long)
  df %>%
    filter(!!sym(.enjeu) == 1) %>%
    group_by(year = year(date), pays) %>%
    mutate(prop_oui = mean(vote_long == "Pour")) %>%
    ungroup() %>%
    ggplot(aes(year, prop_oui, colour = pays)) +
    geom_line(size = 0.8, alpha= 0.8) +
    gghighlight(use_direct_label = FALSE) +
    xlab("") +
    ylab("Prop. annuelle de votes 'oui'") +
    ggtitle(label = sym(.enjeu_long)) +
    facet_wrap(~pays, scales = "free_x", ncol = 4, nrow = 2) +
    scale_y_continuous(labels = scales::percent,
                       limits = c(0, 1), 
                       breaks = c(0.25, 0.50, 0.75)) +
    theme_few() +
    theme(legend.position = "none") +
    theme(strip.text = element_text(hjust = 0.5)) +
    theme(axis.text.x = element_text(angle = 90, hjust = 1)) +
    theme(strip.placement = "outside")
}

graphes_g7 <- map(~ fonction_enjeux(df = onu_enjeux, .enjeu = .x), .x = enjeux$court[2:7])
```

```{r graphique_par_enjeux1, fig.width=6, fig.height=14}
# Premier graphique
patchwork::wrap_plots(graphes_g7[c(3, 2, 6)], ncol = 1) +
  plot_annotation(
  title = "Le Canada appuie particulièrement les initiatives\nde développement économique",
  subtitle = "Il se situe dans la moyenne du G7 sur le désarmement et la question nucélaire"
)
```


```{r graphique_par_enjeux2, fig.width=6, fig.height=14}

# Deuxième graphique
patchwork::wrap_plots(graphes_g7[c(1, 4, 5)], ncol = 1) +
  plot_annotation(
  title = "À l'autre extrème, le Canada a adopté la position américaine\nsur le Moyen-Orient",
  subtitle = "Il est avec la France sur le colonialisme et avec les É.-U. sur les droits de la personne"
)
  
```


Comment l'Irlande, la Norvège, et les pays en développement se situent-ils face à ces enjeux?
------------------------------------------------------------

**Le Canada, l'Irlande et la Norvège ont des positions similaires, sur le désarmement et le développement économique.** En outre, cette position est proche de la position moyenne des pays en développement.

**La position moyenne des pays en développement est similaire à celle de l'Irlande et de la Norvège sur les questions du Moyen-Orient et des droits de la personne.**  Il s'agit, comme nous l'avons vu, des enjeux sur lesquels le Canada est le plus conservateur, même si la position canadienne sur la question des droits de la personne semble vouloir se rapprocher de celle des autres pays du G7, excluant les États-Unis.  

```{r irlande_norvege, fig.width=6, fig.height=14}

onu_enjeux2 <- onu_large %>%
  mutate(
    dev = pays %in% dev,
    lic = pays %in% lic,
    lmic = pays %in% lmic,
    umic = pays %in% umic
  ) %>%
  group_by(year = year(date), pays) %>%
  filter(year > 1989) %>%
  filter(dev == TRUE || pays %in% c("IRL", "NOR", "CAN"))

# À FAIRE: Créer une fonction qui résume les données en fonction d'une liste de groupes de pays qu'on lui passe pour chaque enjeux. Possiblement deux fonctions.

fonction_enjeux2 <- function(df, .enjeu) {
  .enjeu_long <- enjeux %>%
    filter(court == (.enjeu)) %>%
    pull(long)

  # On crée 2 td: un pour IRL/NOR/CAN; et un pour DEV, qu'on joint ensemble
  td_riches <- df %>%
    filter(!!sym(.enjeu) == 1) %>%
    group_by(year = year(date), pays) %>%
    mutate(prop_oui = mean(vote_long == "Pour")) %>%
    filter(pays %in% c("CAN", "NOR", "IRL")) %>%
    distinct(year, .keep_all = TRUE)

  td_dev <- df %>%
    filter(!!sym(.enjeu) == 1) %>%
    ungroup() %>%
    group_by(year = year(date)) %>%
    filter(lmic == 1) %>%
    mutate(prop_oui = mean(vote_long == "Pour")) %>%
    # Une fois prop_oui calculé, on simplifie le tableau
    filter(vote_long == "Pour") %>%
    mutate(pays = "DEV", pays_long = "DEV") %>%
    distinct(year, .keep_all = TRUE)

  # On combine les deux td en un seul
  td <- rbind(td_riches, td_dev)

  # ... qu'on présente en graphique
  td %>%
    ungroup() %>%
    ggplot(aes(year, prop_oui, colour = pays)) +
    geom_line(alpha = 0.8) +
    gghighlight(use_direct_label = FALSE) +
    xlab("") +
    ylab("Prop. annuelle de votes 'oui'") +
    ggtitle(label = sym(.enjeu_long)) +
    facet_wrap(~pays, scales = "free_x", ncol = 4, nrow = 2) +
    scale_y_continuous(labels = scales::percent,
                       limits = c(0, 1), 
                       breaks = c(0.25, 0.50, 0.75)) +
    theme(legend.position = "none") +
    theme(strip.text = element_text(hjust = 0.5)) +
    theme(strip.placement = "outside")
}

graphes_IRL_NOR <- map(~ fonction_enjeux2(df = onu_enjeux2, .enjeu = .x), .x = enjeux$court[2:7])

patchwork::wrap_plots(graphes_IRL_NOR[c(3, 2, 6, 1, 4, 5)], ncol = 1) + plot_layout(guides = "collect") +
  plot_annotation(
    title = "Le Canada diverge particulièrement d'avec les pays en développement sur\nle Moyen-Orient, le colonialisme et les droits de la personne",
    subtitle = "Les positions de l'Irlande et de la Norvège sont souvent moins éloignées"
  )
```

Analyse - Partie 2: Regroupement des pays à l'ONU selon leurs habitudes de votes
=============================================================

```{r definition_tableau_pour_regroupement}
td_long <- onu_large %>%
  filter(year > 2004) %>%
  # Évite les dédoublements, au cas où il y en aurait
  distinct(resid, pays, vote_long) %>%
  # Développe toutes les combinaison pays x resid possibles; introduit des NA
  # dans vote_long où cette combinaison n'existait pas
  complete(pays, nesting(resid)) %>%
  mutate(
    vote_long = replace_na(as.character(vote_long), "na"), # Transforme ces NA en chaînes "na"
    id_vote = str_c("res", resid, vote_long, sep = "_"), # crée un identifiant de vote comme "res_1001_pour"
    valeur = 1 # Cette valeur deviendra notre valeur instrumentale lorsque le tableau sera pivoté
  ) %>%
  # On élimine les situations potentielles de vote unanime, peu utiles pour l'algorithme de groupement
  group_by(resid) %>%
  mutate(variations = n_distinct(vote_long)) %>%
  ungroup() %>%
  filter(variations > 1)

td_large <- td_long %>%
  pivot_wider(
    id_cols = pays,
    names_from = id_vote,
    values_from = valeur,
    values_fill = 0
  ) %>%
  column_to_rownames("pays") %>%
  select(order(colnames(.))) %>%
  mutate(across(where(is.numeric), ~ as.numeric(scale(.))))
```

```{r alogrithme_regroupement_de_base, fig.width=4, fig.height=4}
# Basé sur https://juliasilge.com/blog/kmeans-employment/

regroupements_k <-
  tibble(k = 1:9) %>%
  mutate(
    kclust = map(k, ~ kmeans(td_large, .x)),

    # Extrait un td d'une ligne de l'objet kmeans, incluant tot.withinness
    glanced = map(kclust, glance)
  )

regroupements_k %>%
  unnest(cols = c(glanced)) %>%
  ggplot(aes(x = k, y = tot.withinss)) +
  geom_line(colour = "royalblue4", size = 2, alpha = 0.6) +
  geom_point(size = 2, colour = "royalblue4") +
  ggtitle(label = "Définir six regroupements « k »\nsemble optimal.")
```

```{r}
regroupement_final <- kmeans(td_large, centers = 6, nstart = 20) %>%
  augment(., td_large) %>%
  rename(
    pays = .rownames,
    cluster = .cluster
  ) %>%
  select(pays, cluster)
```


Annexe 1: quelques tests
======================

Les enjeux sont distribués relativement également à travers les années.
```{r dist_annuelles_enjeux, warning=FALSE, fig.height=6, fig.width=6}
resolutions <- onu_large %>%
  group_by(year, resid) %>%
  select(c(year, resid, importantvote, moyen_orient, nucleaire, desarmement, dev_econ, droit_pers, colonialisme)) %>%
  slice_head(n = 1)

resolutions_sommaire <- resolutions %>%
  ungroup() %>%
  group_by(year) %>%
  summarize(
    moyen_orient = sum(moyen_orient),
    nucleaire = sum(nucleaire),
    desarmement = sum(desarmement),
    dev_econ = sum(dev_econ),
    droit_pers = sum(droit_pers),
    colonialisme = sum(colonialisme)
  ) %>%
  pivot_longer(cols = c(
    moyen_orient, nucleaire, desarmement, dev_econ,
    droit_pers, colonialisme
  ), names_to = "enjeu", values_to = "nb")

resolutions_sommaire %>%
  ggplot(aes(x = year, y = nb)) +
  geom_area(alpha = 0.6) +
  facet_wrap(~enjeu) +
  xlim(2000, 2018) +
  labs(x = "", y = "Nombre de résolutions par année") +
  ggtitle(label = "Les questions du désarmement, des droits de la personnne et\ndu nucléaire ont pris de l'ampleur depuis 2015") +
  theme_minimal()
```


Les enjeux ont une faible corrélation entre eux et représentent donc des dimensions distinctes
```{r}
# On crée un tableau des résolutions
td_resolutions <- onu_large %>%
  select(resid, year, importantvote, short, descr, moyen_orient, nucleaire, desarmement, droit_pers, colonialisme, dev_econ, autre, nb_enjeux) %>%
  distinct(resid, .keep_all = TRUE)

td_resolutions %>%
  select(., -c(resid, year, short, descr, autre, nb_enjeux)) %>%
  correlate() %>% shave() %>% fashion()
```

On peut identifier les pays en développement dont les habitudes de vote sont très semblables à celles de la moyenne des pays en développement.
```{r}
onu_enjeux3 <- onu_large %>%
  mutate(dev = pays %in% dev) %>%
  group_by(year = year(date), pays) %>%
  filter(year > 1989) %>%
  filter(dev == TRUE) %>%
  summarize(prop_oui = mean(vote_long == "Pour"))

td <- onu_large %>%
  mutate(dev = pays %in% dev) %>%
  group_by(year = year(date)) %>%
  filter(year > 1989) %>%
  filter(dev == TRUE) %>%
  summarize(prop_oui = mean(vote_long == "Pour")) %>%
  mutate(
    pays = "DEV",
    pays_long = "DEV"
  )

rbind(onu_enjeux3, td) %>%
  group_by(year) %>%
  select(pays, year, prop_oui) %>%
  mutate(prop_oui = scale(prop_oui)) %>%
  ungroup() %>%
  group_by(pays) %>%
  summarize(total = sum(prop_oui)) %>%
  slice_min(order_by = abs(total), n = 20)
```

Annex 2: Échantillons du tableau
================================

Voici un échantillon du tableau des résolutions. 

```{r}
onu_large %>%
  slice_sample(n = 5) %>%
  knitr::kable()
```
